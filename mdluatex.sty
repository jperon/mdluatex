\ProvidesPackage{mdluatex}
\RequirePackage{kvoptions}
\RequirePackage{keycommand}

\directlua{dofile(kpse.find_file("mdluatex.lua"))}
\long\def\md#1{%
    \directlua{direct_md("\luatexluaescapestring{\unexpanded\expandafter{#1}}")}%
}

\newkeycommand*\includemd[][autres][1]{%
\directlua{%
    inclure_md("\luatexluaescapestring{#1}")%
}%
}

\newenvironment{markdown}{%
\directlua{startrecording('markdown')}%
}{%
\directlua{direct_md(stoprecording())}%
}


%~ \long\def\md#1{%
    %~ \directlua{direct_md("\luatexluaescapestring{\unexpanded\expandafter{#1}}")}%
%~ }
